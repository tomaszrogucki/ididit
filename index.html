<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>I DID IT by Effectifier</title>
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

    <!--<script src="js/react.js"></script>-->
    <!--<script src="js/react-dom.js"></script>-->
    <!--<script src="js/browser.min.js"></script>-->
    <!--<script src="js/jquery.min.js"></script>-->
    <!--<script src="https://cdn.jsdelivr.net/lodash/4.9.0/lodash.min.js"></script>-->
    <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>-->

    <style type="text/css">
        /* Restet */
        html, body, div, span, applet, object, iframe,
        h1, h2, h3, h4, h5, h6, p, blockquote, pre,
        a, abbr, acronym, address, big, cite, code,
        del, dfn, em, img, ins, kbd, q, s, samp,
        small, strike, strong, sub, sup, tt, var,
        b, u, i, center,
        dl, dt, dd, ol, ul, li,
        fieldset, form, label, legend,
        table, caption, tbody, tfoot, thead, tr, th, td,
        article, aside, canvas, details, embed,
        figure, figcaption, footer, header, hgroup,
        menu, nav, output, ruby, section, summary,
        time, mark, audio, video {
            margin: 0;
            padding: 0;
            border: 0;
            font-size: 100%;
            font: inherit;
            vertical-align: baseline;
        }
        article, aside, details, figcaption, figure,
        footer, header, hgroup, menu, nav, section {
            display: block;
        }
        body {
            line-height: 1;
        }
        ol, ul {
            list-style: none;
        }
        blockquote, q {
            quotes: none;
        }
        blockquote:before, blockquote:after,
        q:before, q:after {
            content: '';
            content: none;
        }
        table {
            border-collapse: collapse;
            border-spacing: 0;
        }
        /* End of reset */



        @font-face {
            font-family: 'OpenSans-Light';
            src: url("fonts/OpenSans-Light.ttf") format('truetype');
            font-style: normal;
            font-weight: 200;
        }


        body {
            font-size: 16px;
            font-family: 'OpenSans-Light';
            /*line-height: 1.2em;*/
            letter-spacing: 0.1em;
            color: #FF8400;
            background-color: #FFF7EA;
        }

        .hidden {
            display: none;
        }

        .timeline {
            list-style: none;
            position: relative;
        }

        .timeline:before {
            top: 1em;
            bottom: 0;
            position: absolute;
            content: " ";
            width: 2px;
            background-color: #FF8400;
            left: 20%;
            margin-left: -1px;
        }

        .timeline > li {
            margin-bottom: 1em;
            position: relative;
            padding: 0.5em 0 0 0;
        }

        .timeline > li > .time {
            font-size: 0.8em;
            color: rgba(255,132,0,0.6);
        }

        .timeline > li.day > .time {
            font-weight: bold;
            font-size: 1em;
            color: #FF8400;
        }

        .timeline > li > .dot {
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            color: #fff;
            width: 1em;
            height: 1em;
            position: absolute;
            top: 0.5em;
            left: 20%;
            margin-left: -0.5em;
            background-color: #FF8400;
            border: 0.25em solid #FFF7EA;
            z-index: 100;
            border-top-right-radius: 50%;
            border-top-left-radius: 50%;
            border-bottom-right-radius: 50%;
            border-bottom-left-radius: 50%;
        }

        .timeline > li.day > .dot {
            background-color: #FFF7EA;
            border: 0.25em solid #FF8400;
        }

        .timeline > li.month > .dot {
            background-color: #FF8400;
            border: 0.25em solid #FF8400;
        }

        .timeline > li.year > .dot {
            background-color: #FF8400;
            border: 0.25em solid #FF8400;
        }

        .timeline > li > .time {
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            float: left;
            width: 20%;
            text-align: right;
            padding: 0 1em 0 1em;
        }

        .timeline > li > .text {
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            margin-left: 20%;
            width: 60%;
            padding: 0 2em 0 2em;
        }

        .timeline > li.year {
            font-size: 2em;
        }

        .timeline > li.year > .time {
            color: #FF8400;
            font-weight: bold;
        }

        .timeline > li.month {
            font-size: 2em;
        }

        .timeline > li.month > .dot {
            background-color: #FFF7EA;
            border-color: rgba(255,132,0,0.6);
        }

        .form {
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            margin-left: 20%;
            width: 60%;
            padding: 2em 0 2em 0;
        }

        .formContainer {
            background-color: #FF8400;
            margin-bottom: 2em;
        }

        .form form {
            position: relative;
        }

        .form input.addItem {
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            padding: 0 1em 0 1em;
            background-color: #FFF7EA;
            border: 1em solid #FFF7EA;
            border-radius: 2em;
            color: #FF8400;
            font-family: OpenSans-Light;
            font-size: 1em;
            font-weight: bold;
            width: 100%;
            height: 4em;
            outline: none;
        }

        ::-webkit-input-placeholder {
            color:    rgba(255,132,0,0.6);
        }
        :-moz-placeholder {
            color:    rgba(255,132,0,0.6);
        }
        ::-moz-placeholder {
            color:    rgba(255,132,0,0.6);
        }
        :-ms-input-placeholder {
            color:    rgba(255,132,0,0.6);
        }

        .form input.addButton {
            position: absolute;
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            right: 0;
            top: 0;
            width: 4em;
            height: 4em;
            border: 1em solid #FFF7EA;
            border-radius: 2em;
            color: #FFF7EA;
            background-color: #FF8400;
            font-size: 1em;
            cursor: pointer;
            outline: none;
        }

        .form input.addButton:hover {
            color: #FF8400;
            background-color: #FFF7EA;
            border-color: #FF8400;
        }
    </style>

</head>
<body>


<!--
<div class="formContainer">
    <div class="form">
        <form>
            <input value="" placeholder="I did it today..."/>
        </form>
    </div>
</div>


<ul class="timeline">
    <li class="day">
        <div class="dot"></div>
        <div class="time">Today</div>
        <div class="text">&nbsp;</div>
    </li>
    <li>
        <div class="dot"></div>
        <div class="time">15:30</div>
        <div class="text">This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!</div>
    </li>
    <li>
        <div class="dot"></div>
        <div class="time">15:30</div>
        <div class="text">This is what I did today!</div>
    </li>
    <li>
        <div class="dot"></div>
        <div class="time">15:30</div>
        <div class="text">This is what I did today!</div>
    </li>
    <li>
        <div class="dot"></div>
        <div class="time">15:30</div>
        <div class="text">This is what I did today!</div>
    </li>
</ul>

<ul class="timeline">
    <li class="day">
        <div class="dot"></div>
        <div class="time">Yesterday</div>
        <div class="text">&nbsp;</div>
    </li>
    <li>
        <div class="dot"></div>
        <div class="time">15:30</div>
        <div class="text">This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!</div>
    </li>
    <li>
        <div class="dot"></div>
        <div class="time">15:30</div>
        <div class="text">This is what I did today!</div>
    </li>
</ul>

<ul class="timeline">
    <li class="month">
        <div class="dot"></div>
        <div class="time">April</div>
        <div class="text">&nbsp;</div>
    </li>
    <li class="day">
        <div class="dot"></div>
        <div class="time">Yesterday</div>
        <div class="text">&nbsp;</div>
    </li>
    <li>
        <div class="dot"></div>
        <div class="time">15:30</div>
        <div class="text">This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!</div>
    </li>
    <li>
        <div class="dot"></div>
        <div class="time">15:30</div>
        <div class="text">This is what I did today!</div>
    </li>
</ul>

<ul class="timeline">
    <li class="year">
        <div class="dot"></div>
        <div class="time"><span>2016</span></div>
        <div class="text">&nbsp;</div>
    </li>
</ul>
<ul class="timeline">
    <li class="month">
        <div class="dot"></div>
        <div class="time">April</div>
        <div class="text">&nbsp;</div>
    </li>
</ul>
<ul class="timeline">
    <li class="day">
        <div class="dot"></div>
        <div class="time">Monday, 26</div>
        <div class="text">&nbsp;</div>
    </li>
    <li>
        <div class="dot"></div>
        <div class="time">15:30</div>
        <div class="text">This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!This is what I did today!</div>
    </li>
    <li>
        <div class="dot"></div>
        <div class="time">15:30</div>
        <div class="text">This is what I did today!</div>
    </li>
</ul>
-->

<div id="content"></div>
<script type="text/babel">
    var sortNumber = function (a, b) {
        return a - b;
    };


    var LogBox = React.createClass({
        createItemsObject: function (items) {
            items = items || [];
            var itemsObject = {};
            items.forEach(function(value) {
                if(value.date) {
                    var dateObj = new Date(value.date);
                    var year = dateObj.getFullYear();
                    var month = dateObj.getMonth() + 1; //months from 1-12
                    var day = dateObj.getDate();
                    var hour = dateObj.getHours();
                    var minute = dateObj.getMinutes();
                    itemsObject[year] = itemsObject[year] || {};
                    itemsObject[year][month] = itemsObject[year][month] || {};
                    itemsObject[year][month][day] = itemsObject[year][month][day] || {};
                    itemsObject[year][month][day][hour] = itemsObject[year][month][day][hour] || {};
                    itemsObject[year][month][day][hour][minute] = itemsObject[year][month][day][hour][minute] || {};
                    itemsObject[year][month][day][hour][minute][value.date] = value.text;
                }
            });
            return itemsObject;
        },
        loadLog: function () {
            var data = JSON.parse(localStorage.getItem("effectifier:ididit:log")) || {};
            this.setState({data: data});
        },
        handleItemSubmit: function (item) {
            var items = this.state.data.items || [];
            item.date = Date.now();

            var newItems = items.concat([item]);
            var data = this.state.data;
            data.items = newItems;
            localStorage.setItem("effectifier:ididit:log", JSON.stringify(data));
            this.setState({data: data});

        },
        getInitialState: function () {
            return {data: {items: []}};
        },
        componentDidMount: function () {
            this.loadLog();
        },
        render: function () {
            return (
                    <div className="logBox">
                        <ItemForm onItemSubmit={this.handleItemSubmit}/>
                        <YearList data={this.createItemsObject(this.state.data.items)}/>
                    </div>
            );
        }
    });


    var YearList = React.createClass({
        render: function () {
            var years = Object.keys(this.props.data).sort(sortNumber).reverse();
            var yearNodes = years.map(function(year) {
                var dateObj = new Date();
                var theClass = (parseInt(year, 10) !== dateObj.getFullYear()) ? 'timeline' : 'timeline hidden';
                return (
                    <div className="yearItem" key={year}>
                        <ul className={theClass}>
                            <li className="year">
                                <div className="dot"></div>
                                <div className="time"><span>{year}</span></div>
                                <div className="text">&nbsp;</div>
                            </li>
                        </ul>
                        <MonthList data={this.props.data[year]} year={year}/>
                    </div>
                );
            }.bind(this));
            return (
                    <div className="yearList">
                        {yearNodes}
                    </div>
            );
        }
    });


    var MonthList = React.createClass({
        render: function () {
            var year = this.props.year;
            var months = Object.keys(this.props.data).sort(sortNumber).reverse();
            var monthNodes = months.map(function(month) {
                var formatMonth = function (month) {
                    var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                    return months[month-1];
                };
                var dateObj = new Date();
                var theClass = (parseInt(year, 10) === dateObj.getFullYear() && parseInt(month, 10) === dateObj.getMonth() + 1) ? 'timeline hidden' : 'timeline';
                return (
                        <div className="monthItem" key={month}>
                            <ul className={theClass}>
                                <li className="month">
                                    <div className="dot"></div>
                                    <div className="time"><span>{formatMonth(month)}</span></div>
                                    <div className="text">&nbsp;</div>
                                </li>
                            </ul>
                            <DayList data={this.props.data[month]} year={this.props.year} month={month}/>
                        </div>
                );
            }.bind(this));
            return (
                    <div className="monthList">
                        {monthNodes}
                    </div>
            );
        }
    });


    var DayList = React.createClass({
        render: function () {
            var getDayOfWeek = function (obj) {
                var days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
                var dayOfWeekIndex = new Date(obj.year, obj.month - 1, obj.day).getDay();
                return days[dayOfWeekIndex];
            };
            var year = this.props.year;
            var month = this.props.month;
            var days = Object.keys(this.props.data).sort(sortNumber).reverse();
            var dayNodes = days.map(function(day) {
                var dateObj = new Date();
                var dayString = getDayOfWeek({year: year, month: month, day: day}) + ', ' + day;
                var theClass = 'day';
                if (parseInt(year, 10) === dateObj.getFullYear() && parseInt(month, 10) === dateObj.getMonth() + 1) {
                    if (parseInt(day, 10) === dateObj.getDate()) {
                        dayString = 'Today';
//                        theClass = 'day hidden';
                    }
                    else if (parseInt(day, 10) === dateObj.getDate() - 1) {
                        dayString = 'Yesterday';
                    }
                }

                return (
                        <ul className="timeline" key={day}>
                            <li className={theClass}>
                                <div className="dot"></div>
                                <div className="time"><span>{dayString}</span></div>
                                <div className="text">&nbsp;</div>
                            </li>
                            <ItemList data={this.props.data[day]}/>
                        </ul>
                );
            }.bind(this));
            return (
                    <div className="dayList">
                        {dayNodes}
                    </div>
            );
        }
    });


    var ItemList = React.createClass({
        render: function () {
            var formatTime = function (time) {
                return ('0' + time).substr(-2);
            };
            var itemNodes = [];
            var hours = Object.keys(this.props.data).sort(sortNumber).reverse();
            hours.forEach(function(hour) {
                var hourObject = this.props.data[hour];
                var minutes = Object.keys(hourObject).sort(sortNumber).reverse();
                minutes.forEach(function(minute) {
                    var minuteObject = hourObject[minute];
                    var items = Object.keys(minuteObject).sort(sortNumber).reverse();
                    items.forEach(function(item) {
                        itemNodes.push(
                                <li key={item}>
                                    <div className="dot"></div>
                                    <div className="time">{formatTime(hour)}:{formatTime(minute)}</div>
                                    <div className="text">{minuteObject[item]}</div>
                                </li>
                        );
                    }.bind(this));
                }.bind(this));
            }.bind(this));

            return (
                    <ul className="timeline">
                        {itemNodes}
                    </ul>
            );
        }
    });

 

    var ItemForm = React.createClass({
        getInitialState: function () {
            return {text: ''};
        },
        handleTextChange: function (e) {
            this.setState({text: e.target.value});
        },
        handleSubmit: function (e) {
            e.preventDefault();
            var text = this.state.text.trim();
            if (!text) {
                return;
            }
            this.props.onItemSubmit({text: text});
            this.setState({text: ''});
        },
        render: function () {
            return (
                    <div className="formContainer">
                        <div className="form">
                            <form onSubmit={this.handleSubmit}>
                                <input className="addItem" type="text" autofocus placeholder="I did it today..." value={this.state.text} onChange={this.handleTextChange}/>
                                <input className="addButton" type="submit" value="+"/>
                            </form>
                        </div>
                    </div>
            );
        }
    });


    var Item = React.createClass({
        render: function () {
            return (
                    <li>
                        <div className="dot"></div>
                        <div className="time">{this.props.hour}:{this.props.minute}</div>
                        <div className="text">{this.props.children.toString()}</div>
                    </li>
            );
        }
    });


//    var data = [
//        {id: 1, author: "Pete Hunt", text: "This is one comment"},
//        {id: 2, author: "Jordan Walke", text: "This is *another* comment"}
//    ];

    ReactDOM.render(
            <LogBox/>,
            document.getElementById('content')
    );

</script>
</body>
</html>